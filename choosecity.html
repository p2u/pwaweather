<template>
<div class="page" data-name="chooseCityPage">
	<div class="navbar">
		<div class="navbar-inner">
			<div class="title">Vyber město</div>
		</div>
	</div>
	<div class="toolbar">
		<div class="toolbar-inner">
			<a href="#" class="link back">&lt; Zpět</a>
		</div>
	</div>
	<div class="page-content">
		<form id="chooseCity">
		<div class="list">
		  <ul id="cityList">
		  </ul>
		</div>
		</form>
	</div>
</div>
</template>
<script>
return {
	on: {
		pageInit: async function() {
			let form = document.querySelector('#chooseCity');
			let cityList = document.querySelector('#cityList');
			form.addEventListener('change', function(e) {
			  let form = document.querySelector('#chooseCity');
			  setValue(userCityId, form.cityId.value);
			});
			const cityId = getValue(userCityId);
		        const citiesJson = await fetch("./city.cs.list.json");
		        const cities = await citiesJson.json();
			cityList.innerHTML = cities.map(formatItem).join('\n');
			function formatItem(city) {
				const checked = ((cityId == city.id)?'checked=""':'');
				return `
		    <li>
		      <label class="item-radio item-content">
					<input type="radio" name="cityId" value="${city.id}" ${checked} />
		        <i class="icon icon-radio"></i>
		        <div class="item-inner">
					<div class="item-title">${city.name}</div>
		        </div>
		      </label>
		    </li>
					`
			};
		}
	}
}
</script>
